#!/bin/bash
set -e

if [ "$1" == "upload" ]
then
    echo -e "Uploading backups to remote...\n"
    gdrive upload copyData.tar.gz
    rm -rf *
    echo -e "\nBackup uploaded successfully"
elif [ "$1" == "create" ]
then
    echo -e "Creating backup...\n"
    gdrive delete $(gdrive list --no-header | cut -d ' ' -f1)

    dt=$(date '+%d/%m/%Y %H:%M:%S');
    git add --all

    tar -zvcf "$dt.tar.gz" copyData

    rm -f ~/dbBackupID
    echo $(gdrive list --no-header | cut -d ' ' -f1) > ~/dbBackupID

    echo -e "\nBackup created successfully"
elif [ "$1" == "restore" ]
then
    gdrive download $(cat ~/dbBackupID)

    tar -zxvf *.tar.gz

    mongorestore --db INGInious copyData/INGInious/

    rm -rf *
    echo -e "\nBackup restored successfully"
else
    echo -e "Usage:\nuncode_database_backup push\nuncode_database_backup create\nuncode_database_backup restore"
fi

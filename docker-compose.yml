version: "3"

services:
  linter-service:
    image: unjudge/linter-web-service:deployment
    ports:
      - "4567:4567"
  python-tutor:
    image: unjudge/onlinepythontutor:Deployment
    ports:
      - "8003:8003"
  cokapi:
    image: unjudge/cokapi:Deployment
    ports:
      - "3000:3000"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
  db:
    image: mongo:3.4
    ports:
      - "27017:27017"
    volumes:
      - mongo-data:/data/db
  inginious:
    image: unjudge/inginious:Deployment
    ports:
      - "8080:8080"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./tasks:/home/INGInious/tasks
      - ./backup:/home/INGInious/backup
    depends_on:
      - "db"
      - "cokapi"
      - "python-tutor"
      - "linter-service"
    command: ./inginious-webapp --host 0.0.0.0
volumes:
  mongo-data:
